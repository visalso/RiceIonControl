

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fit.FitFunctions &mdash; IonControl 0.8 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="IonControl 0.8 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> IonControl
          

          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FPGAhardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/experimentUi_manual.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/instrumentLoggerUi_manual.html">Instrument Logger User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code/codeDocs.html">Code Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">IonControl</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>fit.FitFunctions</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fit.FitFunctions</h1><div class="highlight"><pre>
<span></span><span class="c1"># *****************************************************************</span>
<span class="c1"># IonControl:  Copyright 2016 Sandia Corporation</span>
<span class="c1"># This Software is released under the GPL license detailed</span>
<span class="c1"># in the file &quot;license.txt&quot; in the top-level IonControl directory</span>
<span class="c1"># *****************************************************************</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">.FitFunctionBase</span> <span class="k">import</span> <span class="n">ResultRecord</span><span class="p">,</span> <span class="n">fitFunctionMap</span>
<span class="kn">from</span> <span class="nn">fit.FitFunctionBase</span> <span class="k">import</span> <span class="n">FitFunctionBase</span>
<span class="kn">from</span> <span class="nn">fit.RabiCarrierFunction</span> <span class="k">import</span> <span class="n">RabiCarrierFunction</span><span class="p">,</span> <span class="n">FullRabiCarrierFunction</span>  <span class="c1">#@UnusedImport</span>
<span class="kn">from</span> <span class="nn">fit.MotionalRabiFlopping</span> <span class="k">import</span> <span class="n">MotionalRabiFlopping</span><span class="p">,</span> <span class="n">TwoModeMotionalRabiFlopping</span> <span class="c1">#@UnusedImport</span>
<span class="kn">from</span> <span class="nn">modules</span> <span class="k">import</span> <span class="n">MagnitudeParser</span>
<span class="kn">from</span> <span class="nn">modules.XmlUtilit</span> <span class="k">import</span> <span class="n">stringToStringOrNone</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">SelectionAnalysis</span>  <span class="c1">#@UnusedImport</span>

<div class="viewcode-block" id="CosFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosFit">[docs]</a><span class="k">class</span> <span class="nc">CosFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Cos&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*cos(2*pi*k*x+theta)+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="CosFit.residuals"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosFit.residuals">[docs]</a>    <span class="k">def</span> <span class="nf">residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allFitParameters</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">theta</span><span class="p">)</span><span class="o">-</span><span class="n">O</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">theta</span><span class="p">)</span><span class="o">-</span><span class="n">O</span></div>
        
<div class="viewcode-block" id="CosFit.value"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosFit.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">p</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="n">O</span></div>

<div class="viewcode-block" id="CosFit.smartStartValues"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosFit.smartStartValues">[docs]</a>    <span class="k">def</span> <span class="nf">smartStartValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="n">parameters</span>   <span class="c1">#@UnusedVariable</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">))))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">A</span><span class="o">=</span><span class="p">(</span><span class="n">maximum</span><span class="o">-</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">O</span><span class="o">=</span><span class="p">(</span><span class="n">maximum</span><span class="o">+</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="c1">#minindex = numpy.argmin(y)</span>
        <span class="n">maxindex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">maximum</span><span class="o">+</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">NewZeroCrossing</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">PreviousZeroCrossing</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">maxZeroCrossingDelta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">]):</span>
                <span class="n">NewZeroCrossing</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">NewZeroCrossingDelta</span> <span class="o">=</span> <span class="n">NewZeroCrossing</span><span class="o">-</span><span class="n">PreviousZeroCrossing</span>
                <span class="k">if</span> <span class="n">NewZeroCrossingDelta</span> <span class="o">&gt;</span> <span class="n">maxZeroCrossingDelta</span><span class="p">:</span>
                    <span class="n">maxZeroCrossingDelta</span> <span class="o">=</span> <span class="n">NewZeroCrossingDelta</span> 
                <span class="n">PreviousZeroCrossing</span> <span class="o">=</span> <span class="n">NewZeroCrossing</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">maxZeroCrossingDelta</span><span class="p">)</span>
<span class="c1">#        theta = numpy.remainder(x0,T)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart start values A=</span><span class="si">{0}</span><span class="s2">, k=</span><span class="si">{1}</span><span class="s2">, theta=</span><span class="si">{2}</span><span class="s2">, O=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span> <span class="p">)</span></div></div>

<div class="viewcode-block" id="SinCosFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinCosFit">[docs]</a><span class="k">class</span> <span class="nc">SinCosFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;SinCos&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*sin(2*pi*k*x)+B*sin(2*pi*k*x)+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResultRecord</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResultRecord</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="SinCosFit.residuals"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinCosFit.residuals">[docs]</a>    <span class="k">def</span> <span class="nf">residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allFitParameters</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">B</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">O</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">B</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">O</span></div>

<div class="viewcode-block" id="SinCosFit.value"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinCosFit.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">p</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">B</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">O</span></div>

<div class="viewcode-block" id="SinCosFit.update"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinCosFit.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">+</span><span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="p">)</span></div></div>

<span class="c1">#     def smartStartValues(self, xIn, yIn, parameters, enabled):</span>
<span class="c1">#         A,B,k,O = parameters   #@UnusedVariable</span>
<span class="c1">#         x,y = zip(*sorted(zip(xIn, yIn)))</span>
<span class="c1">#         x = numpy.array(x)</span>
<span class="c1">#         y = numpy.array(y)</span>
<span class="c1">#         maximum = numpy.amax(y)</span>
<span class="c1">#         minimum = numpy.amin(y)</span>
<span class="c1">#         A=(maximum-minimum)/2</span>
<span class="c1">#         O=(maximum+minimum)/2</span>
<span class="c1">#         #minindex = numpy.argmin(y)</span>
<span class="c1">#         maxindex = numpy.argmax(y)</span>
<span class="c1">#         #theta = x[maxindex]</span>
<span class="c1">#         B=0;</span>
<span class="c1">#         threshold = (maximum+minimum)/2.0</span>
<span class="c1">#         NewZeroCrossing = x[0]</span>
<span class="c1">#         PreviousZeroCrossing = x[0]</span>
<span class="c1">#         maxZeroCrossingDelta = 0</span>
<span class="c1">#         for ind in range(len(y)-1):</span>
<span class="c1">#             if (y[ind] &lt;= threshold &lt;= y[ind+1]) or (y[ind+1] &lt;= threshold &lt;= y[ind]):</span>
<span class="c1">#                 NewZeroCrossing = x[ind]</span>
<span class="c1">#                 NewZeroCrossingDelta = NewZeroCrossing-PreviousZeroCrossing</span>
<span class="c1">#                 if NewZeroCrossingDelta &gt; maxZeroCrossingDelta:</span>
<span class="c1">#                     maxZeroCrossingDelta = NewZeroCrossingDelta</span>
<span class="c1">#                 PreviousZeroCrossing = NewZeroCrossing</span>
<span class="c1">#         k = 1.0/(2.0*maxZeroCrossingDelta)</span>
<span class="c1"># #        theta = numpy.remainder(x0,T)</span>
<span class="c1">#         logging.getLogger(__name__).info(&quot;smart start values A={0}, B={1}, k={2}, O={3}&quot;.format(A,B,k,O))</span>
<span class="c1">#         return (A,B,k,O )</span>

<div class="viewcode-block" id="CosSqFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosSqFit">[docs]</a><span class="k">class</span> <span class="nc">CosSqFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Cos2&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*cos^2(pi*x/(2*T)+theta)+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
       
<div class="viewcode-block" id="CosSqFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosSqFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">T</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">theta</span><span class="p">))</span><span class="o">+</span><span class="n">O</span></div></div>

<div class="viewcode-block" id="CosSqPeakFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosSqPeakFit">[docs]</a><span class="k">class</span> <span class="nc">CosSqPeakFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Cos2 Peak&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*cos^2(pi*(x-x0)/(2*T))+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
       
<div class="viewcode-block" id="CosSqPeakFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosSqPeakFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">O</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">T</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)))</span><span class="o">+</span><span class="n">O</span></div></div>


<div class="viewcode-block" id="SinSqFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinSqFit">[docs]</a><span class="k">class</span> <span class="nc">SinSqFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Sin2&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span> <span class="s1">&#39;(max-min)*sin^2( pi*(x-x0)/(2*T) )+min&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="SinSqFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinSqFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">min_</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">max_</span><span class="o">-</span><span class="n">min_</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">T</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)))</span><span class="o">+</span><span class="n">min_</span></div>

<div class="viewcode-block" id="SinSqFit.smartStartValues"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinSqFit.smartStartValues">[docs]</a>    <span class="k">def</span> <span class="nf">smartStartValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">minimum</span> <span class="o">=</span> <span class="n">parameters</span>   <span class="c1">#@UnusedVariable</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">))))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minindex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">minindex</span><span class="p">]</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">maximum</span><span class="o">+</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">NewZeroCrossing</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">PreviousZeroCrossing</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">maxZeroCrossingDelta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">]):</span>
                <span class="n">NewZeroCrossing</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">NewZeroCrossingDelta</span> <span class="o">=</span> <span class="n">NewZeroCrossing</span><span class="o">-</span><span class="n">PreviousZeroCrossing</span>
                <span class="k">if</span> <span class="n">NewZeroCrossingDelta</span> <span class="o">&gt;</span> <span class="n">maxZeroCrossingDelta</span><span class="p">:</span>
                    <span class="n">maxZeroCrossingDelta</span> <span class="o">=</span> <span class="n">NewZeroCrossingDelta</span> 
                <span class="n">PreviousZeroCrossing</span> <span class="o">=</span> <span class="n">NewZeroCrossing</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">maxZeroCrossingDelta</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart start values T=</span><span class="si">{0}</span><span class="s2">, x0=</span><span class="si">{1}</span><span class="s2">, maximum=</span><span class="si">{2}</span><span class="s2">, minimum=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">minimum</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">minimum</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="DualToneSinSqFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.DualToneSinSqFit">[docs]</a><span class="k">class</span> <span class="nc">DualToneSinSqFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Dual Sin2&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span> <span class="s1">&#39;(max-min)*sin^2( pi*(x-x0)/(2*T) )+min&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;dT&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="DualToneSinSqFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.DualToneSinSqFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">dT</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">max_</span><span class="o">-</span><span class="n">min_</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">dT</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)))</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="n">dT</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)))</span> <span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">min_</span></div></div>

<div class="viewcode-block" id="ChripedSinSqFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.ChripedSinSqFit">[docs]</a><span class="k">class</span> <span class="nc">ChripedSinSqFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ChirpedSin2&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span> <span class="s1">&#39;(max-min)*sin^2( pi*(x-x0)/(2*(T+dt*x) ))+min&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;dt&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="ChripedSinSqFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.ChripedSinSqFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">dt</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">max_</span><span class="o">-</span><span class="n">min_</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)))</span><span class="o">+</span><span class="n">min_</span></div></div>
    
<div class="viewcode-block" id="SaturationFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SaturationFit">[docs]</a><span class="k">class</span> <span class="nc">SaturationFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Saturation&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span> <span class="s1">&#39;A*(x/s)/(1+(x/s))+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span>  <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="SaturationFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SaturationFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">s</span><span class="p">))</span><span class="o">+</span><span class="n">O</span></div>
    
<div class="viewcode-block" id="SaturationFit.smartStartValues"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SaturationFit.smartStartValues">[docs]</a>    <span class="k">def</span> <span class="nf">smartStartValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="n">parameters</span>   <span class="c1">#@UnusedVariable</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">))))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart start values A=</span><span class="si">{0}</span><span class="s2">, s=</span><span class="si">{1}</span><span class="s2">, O=</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span><span class="p">)</span></div></div>
  
<div class="viewcode-block" id="SinSqExpFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinSqExpFit">[docs]</a><span class="k">class</span> <span class="nc">SinSqExpFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Sin2 Exponential Decay&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A * exp(-x/tau) * sin^2(pi/(2*T)*x+theta) + O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
        
<div class="viewcode-block" id="SinSqExpFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinSqExpFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">tau</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">/</span><span class="n">tau</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">T</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">theta</span><span class="p">))</span><span class="o">+</span><span class="n">O</span></div></div>

<div class="viewcode-block" id="CosExpFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosExpFit">[docs]</a><span class="k">class</span> <span class="nc">CosExpFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Cos Exponential Decay&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;(A/2) * (1 - exp(-x/tau)Cos(pi*t/(2*T)+theta)) + O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
        
<div class="viewcode-block" id="CosExpFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.CosExpFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">tau</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">/</span><span class="n">tau</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="n">theta</span><span class="p">))</span><span class="o">+</span><span class="n">O</span>  </div></div>

<div class="viewcode-block" id="SinSqGaussFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinSqGaussFit">[docs]</a><span class="k">class</span> <span class="nc">SinSqGaussFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Sin2 Gaussian Decay&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A * exp(-x^2/tau^2) * sin^2(pi/(2*T)*x+theta) + O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
        
<div class="viewcode-block" id="SinSqGaussFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SinSqGaussFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">tau</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">tau</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">T</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">theta</span><span class="p">))</span><span class="o">+</span><span class="n">O</span></div></div>


<div class="viewcode-block" id="GaussianFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.GaussianFit">[docs]</a><span class="k">class</span> <span class="nc">GaussianFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*exp(-(x-x0)**2/s**2)+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="GaussianFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.GaussianFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">))</span><span class="o">+</span><span class="n">O</span></div>

<div class="viewcode-block" id="GaussianFit.smartStartValues"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.GaussianFit.smartStartValues">[docs]</a>    <span class="k">def</span> <span class="nf">smartStartValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="n">parameters</span>   <span class="c1">#@UnusedVariable</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">))))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maxindex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">maximum</span><span class="o">-</span><span class="n">minimum</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">maximum</span><span class="o">+</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">indexplus</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the last element</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">indexplus</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">maxindex</span>
                <span class="k">break</span>
        <span class="n">indexminus</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the first element</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">indexminus</span> <span class="o">=</span> <span class="n">maxindex</span><span class="o">-</span><span class="n">ind</span>
                <span class="k">break</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">0.60056</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indexplus</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">indexminus</span><span class="p">])</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart start values A=</span><span class="si">{0}</span><span class="s2">, x0=</span><span class="si">{1}</span><span class="s2">, s=</span><span class="si">{2}</span><span class="s2">, O=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="InvertedGaussianFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.InvertedGaussianFit">[docs]</a><span class="k">class</span> <span class="nc">InvertedGaussianFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;InvertedGaussian&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*exp(-(x-x0)**2/s**2)+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="InvertedGaussianFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.InvertedGaussianFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">))</span><span class="o">+</span><span class="n">O</span></div>

<div class="viewcode-block" id="InvertedGaussianFit.smartStartValues"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.InvertedGaussianFit.smartStartValues">[docs]</a>    <span class="k">def</span> <span class="nf">smartStartValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="n">parameters</span>   <span class="c1">#@UnusedVariable</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">))))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maxindex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minindex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">minindex</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">minindex</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">minimum</span><span class="o">-</span><span class="n">maximum</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">maximum</span><span class="o">+</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">indexplus</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the last element</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">minindex</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">indexplus</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">minindex</span>
                <span class="k">break</span>
        <span class="n">indexminus</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the first element</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">minindex</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">indexminus</span> <span class="o">=</span> <span class="n">minindex</span><span class="o">-</span><span class="n">ind</span>
                <span class="k">break</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">0.60056</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indexplus</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">indexminus</span><span class="p">])</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart start values A=</span><span class="si">{0}</span><span class="s2">, x0=</span><span class="si">{1}</span><span class="s2">, s=</span><span class="si">{2}</span><span class="s2">, O=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">O</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="SquareRabiFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SquareRabiFit">[docs]</a><span class="k">class</span> <span class="nc">SquareRabiFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Square Rabi&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A/(1+(2*pi*(x-C)/R)**2) * sin**2(sqrt(1+(2*pi*(x-C)/R)**2)*R*t/2) + O where R=pi/T&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;maxVal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResultRecord</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maxVal&#39;</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="s1">&#39;maximum value of function&#39;</span> <span class="p">)</span>
          
    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SquareRabiFit</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="s1">&#39;maxVal&#39;</span><span class="p">,</span> <span class="n">ResultRecord</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maxVal&#39;</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="s1">&#39;maximum value of function&#39;</span> <span class="p">))</span>
        
<div class="viewcode-block" id="SquareRabiFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SquareRabiFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">T</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="n">R</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">A</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.</span><span class="p">)))</span> <span class="o">+</span> <span class="n">O</span>  </div>
    
<div class="viewcode-block" id="SquareRabiFit.smartStartValues"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SquareRabiFit.smartStartValues">[docs]</a>    <span class="k">def</span> <span class="nf">smartStartValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">parameters</span>   <span class="c1">#@UnusedVariable</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">))))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maxindex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">maximum</span><span class="o">-</span><span class="n">minimum</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">maximum</span><span class="o">+</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>  <span class="c1"># if t is fixed we can estimate T</span>
            <span class="n">indexplus</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the last element</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="n">indexplus</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">maxindex</span>
                    <span class="k">break</span>
            <span class="n">indexminus</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the first element</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="n">indexminus</span> <span class="o">=</span> <span class="n">maxindex</span><span class="o">-</span><span class="n">ind</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">indexplus</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">indexminus</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">T</span> <span class="o">=</span> <span class="mf">0.79869</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indexplus</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">indexminus</span><span class="p">])</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart start values T=</span><span class="si">{0}</span><span class="s2">, C=</span><span class="si">{1}</span><span class="s2">, A=</span><span class="si">{2}</span><span class="s2">, O=</span><span class="si">{3}</span><span class="s2">, t=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="SquareRabiFit.update"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SquareRabiFit.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="c1">#@UnusedVariable</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;maxVal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.</span><span class="p">)))</span> <span class="o">+</span> <span class="n">O</span></div></div>

<div class="viewcode-block" id="SquareRabiFitAmp"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SquareRabiFitAmp">[docs]</a><span class="k">class</span> <span class="nc">SquareRabiFitAmp</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Square Rabi w/Amp&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;(A/(1+(2*pi*(x-C)/R)**2))/(sin**2(R*t/2)) * sin**2(sqrt(1+(2*pi*(x-C)/R)**2)*R*t/2) + O where R=pi/T&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">42.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;maxVal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResultRecord</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maxVal&#39;</span><span class="p">,</span><span class="n">definition</span><span class="o">=</span><span class="s1">&#39;maximum value of function&#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SquareRabiFitAmp</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="s1">&#39;maxVal&#39;</span><span class="p">,</span> <span class="n">ResultRecord</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maxVal&#39;</span><span class="p">,</span><span class="n">definition</span><span class="o">=</span><span class="s1">&#39;maximum value of function&#39;</span> <span class="p">))</span>

<div class="viewcode-block" id="SquareRabiFitAmp.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SquareRabiFitAmp.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">T</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="n">R</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(((</span><span class="n">A</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">u</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))))</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.</span><span class="p">)))</span> <span class="o">+</span> <span class="n">O</span></div>

<div class="viewcode-block" id="SquareRabiFitAmp.smartStartValues"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SquareRabiFitAmp.smartStartValues">[docs]</a>    <span class="k">def</span> <span class="nf">smartStartValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">parameters</span>   <span class="c1">#@UnusedVariable</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">)))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maxindex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">maximum</span><span class="o">-</span><span class="n">minimum</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">maximum</span><span class="o">+</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>  <span class="c1"># if t is fixed we can estimate T</span>
            <span class="n">indexplus</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the last element</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="n">indexplus</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">maxindex</span>
                    <span class="k">break</span>
            <span class="n">indexminus</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the first element</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="n">indexminus</span> <span class="o">=</span> <span class="n">maxindex</span><span class="o">-</span><span class="n">ind</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">indexplus</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">indexminus</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">T</span> <span class="o">=</span> <span class="mf">0.79869</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indexplus</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">indexminus</span><span class="p">])</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart start values T=</span><span class="si">{0}</span><span class="s2">, C=</span><span class="si">{1}</span><span class="s2">, A=</span><span class="si">{2}</span><span class="s2">, O=</span><span class="si">{3}</span><span class="s2">, t=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="SquareRabiFitAmp.update"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.SquareRabiFitAmp.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="c1">#@UnusedVariable</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;maxVal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.</span><span class="p">)))</span> <span class="o">+</span> <span class="n">O</span></div></div>

<div class="viewcode-block" id="LorentzianFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.LorentzianFit">[docs]</a><span class="k">class</span> <span class="nc">LorentzianFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Lorentzian&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*s**2*1/(s**2+(x-x0)**2)+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="LorentzianFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.LorentzianFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">O</span> <span class="p">):</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">s2</span><span class="o">/</span><span class="p">(</span><span class="n">s2</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">))</span><span class="o">+</span><span class="n">O</span></div></div>

<div class="viewcode-block" id="AsymLorentzianFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.AsymLorentzianFit">[docs]</a><span class="k">class</span> <span class="nc">AsymLorentzianFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Asymmetric Lorentzian&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*s**2*1/(s**2+(x-x0)**2)+O s=s1 for x&lt;x0, s=s2 x&gt;x0&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39; s2&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="AsymLorentzianFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.AsymLorentzianFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">O</span> <span class="p">):</span>
        <span class="n">s1sq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
        <span class="n">s2sq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">piecewise</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="o">&gt;</span><span class="n">x0</span><span class="p">],</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">s1sq</span><span class="o">/</span><span class="p">(</span><span class="n">s1sq</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">))</span><span class="o">+</span><span class="n">O</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="n">s2sq</span><span class="o">/</span><span class="p">(</span><span class="n">s2sq</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">))</span><span class="o">+</span><span class="n">O</span><span class="p">]</span> <span class="p">)</span></div></div>

       
<div class="viewcode-block" id="TruncatedLorentzianFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.TruncatedLorentzianFit">[docs]</a><span class="k">class</span> <span class="nc">TruncatedLorentzianFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Truncated Lorentzian&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*s**2*1/(s**2+(x-x0)**2)+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsfcn</span><span class="o">=</span><span class="mf">10.0</span>
        
<div class="viewcode-block" id="TruncatedLorentzianFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.TruncatedLorentzianFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">O</span><span class="p">):</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">s2</span><span class="o">/</span><span class="p">(</span><span class="n">s2</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">O</span></div></div>

<div class="viewcode-block" id="LinearFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.LinearFit">[docs]</a><span class="k">class</span> <span class="nc">LinearFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;class for fitting to a line</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;m*x + b&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">halfpoint</span> <span class="o">=</span> <span class="mi">0</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;halfpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResultRecord</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;halfpoint&#39;</span><span class="p">)</span>
        
<div class="viewcode-block" id="LinearFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.LinearFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span></div>
        
<div class="viewcode-block" id="LinearFit.update"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.LinearFit.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;halfpoint&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">m</span></div></div>

<div class="viewcode-block" id="RabiFieldProfileFit"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.RabiFieldProfileFit">[docs]</a><span class="k">class</span> <span class="nc">RabiFieldProfileFit</span><span class="p">(</span><span class="n">FitFunctionBase</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;RabiFieldProfileFit&quot;</span>
    <span class="n">functionString</span> <span class="o">=</span>  <span class="s1">&#39;A*sin(c*exp(-(x-x0)**2/w**2)**2+O&#39;</span>
    <span class="n">parameterNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FitFunctionBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startParameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
<div class="viewcode-block" id="RabiFieldProfileFit.functionEval"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.RabiFieldProfileFit.functionEval">[docs]</a>    <span class="k">def</span> <span class="nf">functionEval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">O</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="n">w</span><span class="p">))))</span> <span class="o">+</span> <span class="n">O</span></div>

<div class="viewcode-block" id="RabiFieldProfileFit.smartStartValues"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.RabiFieldProfileFit.smartStartValues">[docs]</a>    <span class="k">def</span> <span class="nf">smartStartValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="n">parameters</span>   <span class="c1">#@UnusedVariable</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xIn</span><span class="p">,</span> <span class="n">yIn</span><span class="p">))))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maxindex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">maxindex</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">maximum</span><span class="p">))</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">maximum</span><span class="o">+</span><span class="n">minimum</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">indexplus</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the last element</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">indexplus</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">maxindex</span>
                <span class="k">break</span>
        <span class="n">indexminus</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#If the threshold point is never found, indexplus is set to the index of the first element</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">maxindex</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">indexminus</span> <span class="o">=</span> <span class="n">maxindex</span><span class="o">-</span><span class="n">ind</span>
                <span class="k">break</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mf">0.60056</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indexplus</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">indexminus</span><span class="p">])</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smart start values A=</span><span class="si">{0}</span><span class="s2">, c=</span><span class="si">{1}</span><span class="s2">, x0=</span><span class="si">{2}</span><span class="s2">, w=</span><span class="si">{3}</span><span class="s2">, O=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">O</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">O</span><span class="p">)</span></div></div>
               
<div class="viewcode-block" id="fitFunctionFactory"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.fitFunctionFactory">[docs]</a><span class="k">def</span> <span class="nf">fitFunctionFactory</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a FitFunction Object from a saved string representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">fitFunctionMap</span><span class="p">[</span><span class="n">name</span><span class="p">]()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">MagnitudeParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">function</span></div>

<div class="viewcode-block" id="fromXmlElement"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.fromXmlElement">[docs]</a><span class="k">def</span> <span class="nf">fromXmlElement</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a FitFunction Object from a saved string representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">fitFunctionMap</span><span class="p">[</span><span class="n">name</span><span class="p">]()</span>
    <span class="n">function</span><span class="o">.</span><span class="n">parametersConfidence</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">function</span><span class="o">.</span><span class="n">parameterEnabled</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">function</span><span class="o">.</span><span class="n">startParameterExpressions</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">function</span><span class="o">.</span><span class="n">parameterBounds</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">function</span><span class="o">.</span><span class="n">parameterBoundsExpressions</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;Parameter&quot;</span><span class="p">)):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1">#function.parameterNames[index] = parameter.attrib[&#39;name&#39;]</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parametersConfidence</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameterEnabled</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span>
        <span class="n">function</span><span class="o">.</span><span class="n">startParameterExpressions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">stringToStringOrNone</span><span class="p">(</span> <span class="n">parameter</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;startExpression&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameterBounds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span> <span class="n">stringToStringOrNone</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bounds&#39;</span><span class="p">,</span> <span class="s1">&#39;None,None&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameterBoundsExpressions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span> <span class="n">stringToStringOrNone</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;boundsExpression&#39;</span><span class="p">,</span> <span class="s1">&#39;None,None&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="p">))</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;Result&quot;</span><span class="p">)):</span>
        <span class="n">name</span><span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">function</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResultRecord</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                               <span class="n">definition</span> <span class="o">=</span> <span class="n">stringToStringOrNone</span><span class="p">(</span> <span class="n">parameter</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">]</span> <span class="p">),</span>
                               <span class="n">value</span> <span class="o">=</span> <span class="n">MagnitudeParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">function</span></div>

<div class="viewcode-block" id="fromHdf5"><a class="viewcode-back" href="../../code/fit-doc.html#fit.FitFunctions.fromHdf5">[docs]</a><span class="k">def</span> <span class="nf">fromHdf5</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">fitFunctionMap</span><span class="p">[</span><span class="n">name</span><span class="p">]()</span>
    <span class="n">function</span><span class="o">.</span><span class="n">parametersConfidence</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">function</span><span class="o">.</span><span class="n">parameterEnabled</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">function</span><span class="o">.</span><span class="n">startParameterExpressions</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">function</span><span class="o">.</span><span class="n">parameterBounds</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">function</span><span class="o">.</span><span class="n">parameterBoundsExpressions</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parametersConfidence</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;confidence&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameterEnabled</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
        <span class="n">function</span><span class="o">.</span><span class="n">startParameterExpressions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;startExpression&#39;</span><span class="p">]</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameterBounds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;bounds&#39;</span><span class="p">])</span>
        <span class="n">function</span><span class="o">.</span><span class="n">parameterBoundsExpressions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span> <span class="n">stringToStringOrNone</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;boundsExpression&#39;</span><span class="p">,</span> <span class="s1">&#39;None,None&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="p">))</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]:</span>
        <span class="n">function</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResultRecord</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                               <span class="n">definition</span> <span class="o">=</span> <span class="n">stringToStringOrNone</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="n">attribs</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">]</span> <span class="p">),</span>
                               <span class="n">value</span> <span class="o">=</span> <span class="n">MagnitudeParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">attribs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">function</span></div>

        
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">y_meas</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
    <span class="n">f</span> <span class="o">=</span> <span class="n">CosFit</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">2.3e-2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">ls</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_meas</span><span class="p">,</span> <span class="n">p</span> <span class="p">)</span>
    
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ls</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_meas</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_true</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Least-squares fit to noisy data&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Fit&#39;</span><span class="p">,</span> <span class="s1">&#39;Noisy&#39;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>