

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>gui.ScanExperiment &mdash; IonControl 0.8 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="IonControl 0.8 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> IonControl
          

          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FPGAhardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/experimentUi_manual.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/instrumentLoggerUi_manual.html">Instrument Logger User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code/codeDocs.html">Code Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">IonControl</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>gui.ScanExperiment</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for gui.ScanExperiment</h1><div class="highlight"><pre>
<span></span><span class="c1"># *****************************************************************</span>
<span class="c1"># IonControl:  Copyright 2016 Sandia Corporation</span>
<span class="c1"># This Software is released under the GPL license detailed</span>
<span class="c1"># in the file &quot;license.txt&quot; in the top-level IonControl directory</span>
<span class="c1"># *****************************************************************</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Experiment code to scan a parameter that is controlled by the FPGA.</span>

<span class="sd">The Pulse Program for each point od the scan, the Pulse Program receives the</span>
<span class="sd">address and value of the scanned parameter on its pipe input. It is expected to</span>
<span class="sd">echo those on the pipe output followed by the measurement results.</span>
<span class="sd">It is expected to send an endlabel (0xffffffff) when finished.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">from</span> <span class="nn">persist.StringTable</span> <span class="k">import</span> <span class="n">DataStore</span>
<span class="kn">from</span> <span class="nn">trace</span> <span class="k">import</span> <span class="n">Traceui</span>
<span class="kn">from</span> <span class="nn">trace</span> <span class="k">import</span> <span class="n">NamedTraceui</span>

<span class="kn">from</span> <span class="nn">trace</span> <span class="k">import</span> <span class="n">pens</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">import</span> <span class="nn">PyQt5.uic</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyqtgraph.dockarea</span> <span class="k">import</span> <span class="n">DockArea</span><span class="p">,</span> <span class="n">Dock</span>
<span class="kn">from</span> <span class="nn">pyqtgraph.graphicsItems.ViewBox</span> <span class="k">import</span> <span class="n">ViewBox</span>
<span class="kn">from</span> <span class="nn">pyqtgraph.exporters.ImageExporter</span> <span class="k">import</span> <span class="n">ImageExporter</span>
<span class="kn">from</span> <span class="nn">pyqtgraph.exporters.SVGExporter</span> <span class="k">import</span> <span class="n">SVGExporter</span>

<span class="kn">from</span> <span class="nn">.AverageViewTable</span> <span class="k">import</span> <span class="n">AverageViewTable</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">MainWindowWidget</span>
<span class="kn">from</span> <span class="nn">trace</span> <span class="k">import</span> <span class="n">RawData</span>
<span class="kn">from</span> <span class="nn">scan.ScanControl</span> <span class="k">import</span> <span class="n">ScanControl</span>
<span class="kn">from</span> <span class="nn">scan.EvaluationControl</span> <span class="k">import</span> <span class="n">EvaluationControl</span>
<span class="kn">from</span> <span class="nn">.ScanProgress</span> <span class="k">import</span> <span class="n">ScanProgress</span>
<span class="kn">from</span> <span class="nn">fit.FitUi</span> <span class="k">import</span> <span class="n">FitUi</span>
<span class="kn">from</span> <span class="nn">modules</span> <span class="k">import</span> <span class="n">DataDirectory</span>
<span class="kn">from</span> <span class="nn">modules</span> <span class="k">import</span> <span class="n">enum</span>
<span class="kn">from</span> <span class="nn">modules</span> <span class="k">import</span> <span class="n">stringutilit</span>
<span class="kn">from</span> <span class="nn">trace.PlottedTrace</span> <span class="k">import</span> <span class="n">PlottedTrace</span>
<span class="kn">from</span> <span class="nn">trace.TraceCollection</span> <span class="k">import</span> <span class="n">TraceCollection</span>
<span class="kn">from</span> <span class="nn">uiModules.CoordinatePlotWidget</span> <span class="k">import</span> <span class="n">CoordinatePlotWidget</span>
<span class="kn">from</span> <span class="nn">modules</span> <span class="k">import</span> <span class="n">WeakMethod</span>
<span class="kn">from</span> <span class="nn">modules.SceneToPrint</span> <span class="k">import</span> <span class="n">SceneToPrint</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">gui.ScanMethods</span> <span class="k">import</span> <span class="n">ScanMethodsDict</span><span class="p">,</span> <span class="n">ScanException</span><span class="p">,</span> <span class="n">ExternalScanMethod</span>
<span class="kn">from</span> <span class="nn">gui.ScanGenerators</span> <span class="k">import</span> <span class="n">GeneratorList</span>
<span class="kn">from</span> <span class="nn">modules.quantity</span> <span class="k">import</span> <span class="n">is_Q</span><span class="p">,</span> <span class="n">Q</span>
<span class="kn">from</span> <span class="nn">persist.MeasurementLog</span> <span class="k">import</span>  <span class="n">Measurement</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Result</span>
<span class="kn">from</span> <span class="nn">scan.AnalysisControl</span> <span class="k">import</span> <span class="n">AnalysisControl</span>   <span class="c1">#@UnresolvedImport</span>
<span class="kn">from</span> <span class="nn">modules.Utility</span> <span class="k">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">pytz</span>

<span class="kn">from</span> <span class="nn">ProjectConfig.Project</span> <span class="k">import</span> <span class="n">getProject</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">modules</span> <span class="k">import</span> <span class="n">InkscapeConversion</span>
<span class="kn">from</span> <span class="nn">AWG</span> <span class="k">import</span> <span class="n">AWGDevices</span>

<span class="n">uipath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;ui/ScanExperiment.ui&#39;</span><span class="p">)</span>
<span class="n">ScanExperimentForm</span><span class="p">,</span> <span class="n">ScanExperimentBase</span> <span class="o">=</span> <span class="n">PyQt5</span><span class="o">.</span><span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span><span class="n">uipath</span><span class="p">)</span>

<span class="n">ExpectedLoopkup</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;-i&#39;</span><span class="p">:</span><span class="mf">0.5</span> <span class="p">}</span>

<span class="n">FifoDepth</span> <span class="o">=</span> <span class="mi">1020</span>


<div class="viewcode-block" id="ScanExperimentContext"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperimentContext">[docs]</a><span class="k">class</span> <span class="nc">ScanExperimentContext</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class encapsulates all variables, settings and data of the scan.</span>
<span class="sd">    It is used in order to implement the ability to stash and resumea ScanExperiment&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">histogramCurveList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentTimestampTrace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">histogramList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">histogramTrace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">histogramBuffer</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span> <span class="nb">list</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">otherDataFile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanMethod</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawDataFile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalOverrides</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revertGlobalsValues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisName</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="ScanExperimentContext.overrideGlobals"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperimentContext.overrideGlobals">[docs]</a>    <span class="k">def</span> <span class="nf">overrideGlobals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">globalDict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revertGlobals</span><span class="p">(</span><span class="n">globalDict</span><span class="p">)</span>  <span class="c1"># make sure old values were reverted e.g. when calling start on a running scan</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalOverrides</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revertGlobalsValues</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">globalDict</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
            <span class="n">globalDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="ScanExperimentContext.revertGlobals"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperimentContext.revertGlobals">[docs]</a>    <span class="k">def</span> <span class="nf">revertGlobals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">globalDict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">revertGlobalsValues</span><span class="p">:</span>
            <span class="n">globalDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revertGlobalsValues</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">settingsName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">list</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">/</span><span class="si">{2}</span><span class="s2">) started </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">settingsName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">list</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startTime</span><span class="p">))</span></div>

<div class="viewcode-block" id="ScanExperiment"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment">[docs]</a><span class="k">class</span> <span class="nc">ScanExperiment</span><span class="p">(</span><span class="n">ScanExperimentForm</span><span class="p">,</span> <span class="n">MainWindowWidget</span><span class="o">.</span><span class="n">MainWindowWidget</span><span class="p">):</span>
    <span class="n">StatusMessage</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span> <span class="nb">str</span> <span class="p">)</span>
    <span class="n">ClearStatusMessage</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">NeedsDDSRewrite</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">plotsChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">ppStartSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">ppStopSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">OpStates</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">enum</span><span class="p">(</span><span class="s1">&#39;idle&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;paused&#39;</span><span class="p">,</span> <span class="s1">&#39;starting&#39;</span><span class="p">,</span> <span class="s1">&#39;stopping&#39;</span><span class="p">,</span> <span class="s1">&#39;interrupted&#39;</span><span class="p">,</span> <span class="s1">&#39;stashing&#39;</span><span class="p">,</span> <span class="s1">&#39;resuming&#39;</span><span class="p">)</span>
    <span class="n">experimentName</span> <span class="o">=</span> <span class="s1">&#39;Scan Sequence&#39;</span>
    <span class="n">statusChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span>
    <span class="n">scanConfigurationListChanged</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">evaluationConfigurationChanged</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">analysisConfigurationChanged</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">evaluatedDataSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span> <span class="nb">dict</span> <span class="p">)</span> <span class="c1">#key is the eval name, val is (x, y)</span>
    <span class="n">allDataSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span> <span class="nb">dict</span> <span class="p">)</span> <span class="c1">#key is the eval name, val is (xlist, ylist)</span>
    <span class="n">stashChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span> <span class="c1"># indicates that the size of the stash has changed</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">pulserHardware</span><span class="p">,</span> <span class="n">globalVariablesUi</span><span class="p">,</span> <span class="n">experimentName</span><span class="p">,</span> <span class="n">toolBar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">measurementLog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callWhenDoneAdjusting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dbConnection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MainWindowWidget</span><span class="o">.</span><span class="n">MainWindowWidget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toolBar</span><span class="o">=</span><span class="n">toolBar</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">ScanExperimentForm</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deviceSettings</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span> <span class="o">=</span> <span class="n">pulserHardware</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">ScanExperimentContext</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span> <span class="o">=</span> <span class="n">experimentName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interruptReason</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableParameter</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableExternalParameter</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalVariables</span> <span class="o">=</span> <span class="n">globalVariablesUi</span><span class="o">.</span><span class="n">globalDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesChanged</span> <span class="o">=</span> <span class="n">globalVariablesUi</span><span class="o">.</span><span class="n">valueChanged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesUi</span> <span class="o">=</span> <span class="n">globalVariablesUi</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">scanTargetDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span> <span class="o">=</span> <span class="n">measurementLog</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">callWhenDoneAdjusting</span> <span class="o">=</span> <span class="n">callWhenDoneAdjusting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accumulatedTimingViolations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">getProject</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">preferences</span> <span class="c1">#this is really print preferences being handed down to TraceUi to find gnuplot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestampsEnabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">(</span><span class="s1">&#39;software&#39;</span><span class="p">,</span> <span class="s1">&#39;Timestamps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unsavedTraceCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stash</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbConnection</span> <span class="o">=</span> <span class="n">dbConnection</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbConnection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataStore</span> <span class="o">=</span> <span class="n">DataStore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbConnection</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataStore</span><span class="o">.</span><span class="n">open_session</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataStore</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramIdentifier</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># will save the hash of the Pulse Program</span>

<div class="viewcode-block" id="ScanExperiment.setupUi"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.setupUi">[docs]</a>    <span class="k">def</span> <span class="nf">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MainWindow</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">ScanExperimentForm</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MainWindow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">DockArea</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">axesType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s1">&#39;.axesType&#39;</span><span class="p">,</span> <span class="n">defaultdict</span><span class="p">(</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span> <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">requiredPlotNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Scan Data&quot;</span><span class="p">,</span> <span class="s2">&quot;Histogram&quot;</span><span class="p">,</span> <span class="s2">&quot;Timestamps&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestampsEnabled</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;Scan Data&quot;</span><span class="p">,</span> <span class="s2">&quot;Histogram&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s1">&#39;.plotNames&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="n">plotNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s1">&#39;.plotNames&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requiredPlotNames</span><span class="p">:</span> <span class="c1">#make sure required plots are present</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotNames</span><span class="p">:</span>
                    <span class="n">plotNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotNames</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredPlotNames</span><span class="p">)</span>
        <span class="c1"># initialize all the plot windows we want</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createPlotWindows</span><span class="p">(</span><span class="n">plotNames</span><span class="p">,</span> <span class="n">axesType</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s1">&#39;.pyqtgraph-dockareastate&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">restoreState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s1">&#39;.pyqtgraph-dockareastate&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1">#If an except occurs, we have to completely rebuild the DockArea</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cannot restore dock state in experiment </span><span class="si">{0}</span><span class="s2">. Exception occurred: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">DockArea</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createPlotWindows</span><span class="p">(</span><span class="n">plotNames</span><span class="p">,</span> <span class="n">axesType</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">plotNames</span> <span class="c1">#I don&#39;t want to leave this list around, as it is not updated and may cause confusion.</span>

        <span class="c1"># Traceui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">penicons</span> <span class="o">=</span> <span class="n">pens</span><span class="o">.</span><span class="n">penicons</span><span class="p">()</span><span class="o">.</span><span class="n">penicons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span> <span class="o">=</span> <span class="n">Traceui</span><span class="o">.</span><span class="n">Traceui</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">penicons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">,</span> <span class="n">hasMeasurementLog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">highlightUnsaved</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">addTraceui</span><span class="p">(</span> <span class="s1">&#39;Scan&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">traceuiLookup</span><span class="p">[</span><span class="s1">&#39;Script&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">traceModelDataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">measurementModel</span><span class="o">.</span><span class="n">onTraceModelDataChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">measurementModel</span><span class="o">.</span><span class="n">measurementModelDataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">onMeasurementModelDataChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">traceRemoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">measurementModel</span><span class="o">.</span><span class="n">onTraceRemoved</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">openMeasurementLog</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">onOpenMeasurementLog</span><span class="p">)</span>
        <span class="c1"># traceui for timestamps</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestampsEnabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestampTraceui</span> <span class="o">=</span> <span class="n">Traceui</span><span class="o">.</span><span class="n">Traceui</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">penicons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s2">&quot;-timestamps&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestampTraceui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestampTraceui</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestampTraceuiDock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestampTraceui</span><span class="p">,</span> <span class="s2">&quot;Timestamp traces&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftDockWidgetArea</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span> <span class="o">=</span> <span class="n">NamedTraceui</span><span class="o">.</span><span class="n">NamedTraceui</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">penicons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">,</span> <span class="n">hasMeasurementLog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">highlightUnsaved</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">addTraceui</span><span class="p">(</span> <span class="s1">&#39;Scan&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">traceuiLookup</span><span class="p">[</span><span class="s1">&#39;Script&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">traceModelDataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">measurementModel</span><span class="o">.</span><span class="n">onTraceModelDataChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">measurementModel</span><span class="o">.</span><span class="n">measurementModelDataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">onMeasurementModelDataChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">traceRemoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">measurementModel</span><span class="o">.</span><span class="n">onTraceRemoved</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span><span class="o">.</span><span class="n">openMeasurementLog</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">onOpenMeasurementLog</span><span class="p">)</span>

        <span class="c1"># new fit widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitWidget</span> <span class="o">=</span> <span class="n">FitUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="p">,</span> <span class="n">globalDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesUi</span><span class="o">.</span><span class="n">globalDict</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitWidget</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesUi</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitWidget</span><span class="o">.</span><span class="n">evaluate</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitWidgetDock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitWidget</span><span class="p">,</span> <span class="s2">&quot;Fit&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftDockWidgetArea</span><span class="p">,</span>
                                                    <span class="n">stackAbove</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestampTraceuiDock</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestampsEnabled</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># TraceuiDock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceuiDock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="p">,</span> <span class="s2">&quot;Traces&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftDockWidgetArea</span><span class="p">,</span> <span class="n">stackAbove</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fitWidgetDock</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceuiDock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span><span class="p">,</span> <span class="s2">&quot;Named Traces&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftDockWidgetArea</span><span class="p">,</span> <span class="n">stackAbove</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fitWidgetDock</span> <span class="p">)</span>
        <span class="c1"># ScanProgress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span> <span class="o">=</span> <span class="n">ScanProgress</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setupUi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateChanged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">stateChanged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="p">,</span> <span class="s2">&quot;Progress&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">)</span>
        <span class="c1"># Average View</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayUi</span> <span class="o">=</span> <span class="n">AverageViewTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayUi</span><span class="o">.</span><span class="n">setupUi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayUi</span><span class="p">,</span> <span class="s2">&quot;Average&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">)</span>
        <span class="c1"># Scan Control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span> <span class="o">=</span> <span class="n">ScanControl</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesUi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">currentScanChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setScanLabel</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlDock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="p">,</span> <span class="s2">&quot;Scan Control&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanConfigurationListChanged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">scanConfigurationListChanged</span>
        <span class="c1"># EvaluationControl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span> <span class="o">=</span> <span class="n">EvaluationControl</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesUi</span><span class="o">.</span><span class="n">globalDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                                         <span class="n">analysisNames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fitWidget</span><span class="o">.</span><span class="n">analysisNames</span><span class="p">(),</span>
                                                         <span class="n">counterNames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">pulserConfiguration</span><span class="p">()</span><span class="o">.</span><span class="n">counterBits</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">pulserConfiguration</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">currentEvaluationChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setEvaluationLabel</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">evaluate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitWidget</span><span class="o">.</span><span class="n">analysisNamesChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">setAnalysisNames</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlDock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="p">,</span> <span class="s2">&quot;Evaluation Control&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">,</span> <span class="n">stackAbove</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scanControlDock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluationConfigurationChanged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">evaluationConfigurationChanged</span>
        <span class="c1"># Analysis Control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span> <span class="o">=</span> <span class="n">AnalysisControl</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesUi</span><span class="o">.</span><span class="n">globalDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">evaluationNames</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">currentAnalysisChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setAnalysisLabel</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlDock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupAsDockWidget</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="p">,</span> <span class="s2">&quot;Analysis Control&quot;</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">,</span> <span class="n">stackAbove</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlDock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesUi</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">evaluate</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisConfigurationChanged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">analysisConfigurationChanged</span>

        <span class="c1">#toolBar actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyHistogram</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/openicon/icons/office-chart-bar.png&quot;</span><span class="p">),</span> <span class="s2">&quot;Copy histogram to traces&quot;</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyHistogram</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Copy histogram to traces&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyHistogram</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">onCopyHistogram</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyHistogram</span> <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">saveHistogram</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/openicon/icons/office-chart-bar-save.png&quot;</span><span class="p">),</span> <span class="s2">&quot;Save histograms&quot;</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveHistogram</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Save histograms for last run to file&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveHistogram</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSaveHistogram</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveHistogram</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actionAddPlot</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/openicon/icons/add-plot.png&quot;</span><span class="p">),</span> <span class="s2">&quot;Add new plot&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionAddPlot</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Add new plot&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionAddPlot</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onAddPlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionAddPlot</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">removePlot</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/openicon/icons/remove-plot.png&quot;</span><span class="p">),</span> <span class="s2">&quot;Remove a plot&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removePlot</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Remove a plot&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removePlot</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onRemovePlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removePlot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">renamePlot</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/openicon/icons/rename-plot.png&quot;</span><span class="p">),</span> <span class="s2">&quot;Rename a plot&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renamePlot</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Rename a plot&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renamePlot</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onRenamePlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renamePlot</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">addPushDestination</span><span class="p">(</span><span class="s1">&#39;Global&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesUi</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.createPlotWindows"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.createPlotWindows">[docs]</a>    <span class="k">def</span> <span class="nf">createPlotWindows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotNames</span><span class="p">,</span> <span class="n">axesType</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">plotNames</span><span class="p">:</span>
            <span class="n">dock</span> <span class="o">=</span> <span class="n">Dock</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">CoordinatePlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">axesType</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">setTimeAxis</span><span class="p">(</span><span class="n">axesType</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">_graphicsView</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">addDock</span><span class="p">(</span><span class="n">dock</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
            <span class="n">dock</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dock&quot;</span><span class="p">:</span><span class="n">dock</span><span class="p">,</span> <span class="s2">&quot;widget&quot;</span><span class="p">:</span><span class="n">widget</span><span class="p">,</span> <span class="s2">&quot;view&quot;</span><span class="p">:</span><span class="n">view</span><span class="p">}</span>
            <span class="k">del</span> <span class="n">dock</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">view</span> <span class="c1">#This is probably unnecessary, but can&#39;t hurt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="s2">&quot;Histogram&quot;</span><span class="p">][</span><span class="s2">&quot;widget&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">autoRange</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestampsEnabled</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">][</span><span class="s2">&quot;widget&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">autoRange</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.reAnalyze"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.reAnalyze">[docs]</a>    <span class="k">def</span> <span class="nf">reAnalyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plottedTrace</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">plottedTrace</span><span class="p">)</span> <span class="k">for</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">plottedTrace</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>
        
<div class="viewcode-block" id="ScanExperiment.printTargets"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.printTargets">[docs]</a>    <span class="k">def</span> <span class="nf">printTargets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="ScanExperiment.addPushDestination"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.addPushDestination">[docs]</a>    <span class="k">def</span> <span class="nf">addPushDestination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">addPushDestination</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ScanExperiment.setupAsDockWidget"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.setupAsDockWidget">[docs]</a>    <span class="k">def</span> <span class="nf">setupAsDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">,</span> <span class="n">stackAbove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stackBelow</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="n">dock</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QDockWidget</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">dock</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">dock</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span> <span class="n">widget</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addDockWidget</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">dock</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dockWidgetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dock</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">stackAbove</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabifyDockWidget</span><span class="p">(</span> <span class="n">stackAbove</span><span class="p">,</span> <span class="n">dock</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="n">stackBelow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabifyDockWidget</span><span class="p">(</span> <span class="n">dock</span><span class="p">,</span> <span class="n">stackBelow</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">dock</span>           </div>

<div class="viewcode-block" id="ScanExperiment.setPulseProgramUi"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.setPulseProgramUi">[docs]</a>    <span class="k">def</span> <span class="nf">setPulseProgramUi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulseProgramUi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span> <span class="o">=</span> <span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">addExperiment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalVariables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalVariablesChanged</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">setVariables</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">pulseProgram</span><span class="o">.</span><span class="n">variabledict</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">pulseProgramChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">updatePulseProgram</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">setPulseProgramUi</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span> <span class="p">)</span></div>
        
<div class="viewcode-block" id="ScanExperiment.updatePulseProgram"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.updatePulseProgram">[docs]</a>    <span class="k">def</span> <span class="nf">updatePulseProgram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">setVariables</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">pulseProgram</span><span class="o">.</span><span class="n">variabledict</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">setPulseProgramUi</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.onClear"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onClear">[docs]</a>    <span class="k">def</span> <span class="nf">onClear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dockWidget</span><span class="o">.</span><span class="n">setShown</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StatusMessage</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;test Clear not implemented&quot;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ScanExperiment.onSave"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onSave">[docs]</a>    <span class="k">def</span> <span class="nf">onSave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
    
<div class="viewcode-block" id="ScanExperiment.setTimeLabel"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.setTimeLabel">[docs]</a>    <span class="k">def</span> <span class="nf">setTimeLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">startTime</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">elapsed</span> <span class="o">/</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">list</span><span class="p">),</span> <span class="mi">1</span><span class="p">)))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">timeLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> / </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)),</span>
                                                 <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">expected</span><span class="p">))))</span> </div>
 
<div class="viewcode-block" id="ScanExperiment.onStart"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onStart">[docs]</a>    <span class="k">def</span> <span class="nf">onStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">globalOverrides</span><span class="o">=</span><span class="nb">list</span><span class="p">()):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;globalOverrides: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">globalOverrides</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">globalOverrides</span> <span class="o">=</span> <span class="n">globalOverrides</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">analysisName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">currentAnalysisName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">overrideGlobals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globalVariables</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accumulatedTimingViolations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">setTimingViolations</span><span class="p">(</span> <span class="p">[]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">getScan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">getEvaluation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayUi</span><span class="o">.</span><span class="n">setNames</span><span class="p">(</span> <span class="p">[</span><span class="n">evaluation</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">evaluation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span> <span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">scanTarget</span> <span class="ow">in</span> <span class="n">ScanMethodsDict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span> <span class="o">=</span> <span class="n">ScanMethodsDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">scanTarget</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span> <span class="o">=</span> <span class="n">ExternalScanMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">scanTarget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setStarting</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppStartSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callWhenDoneAdjusting</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startScan</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callWhenDoneAdjusting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startScan</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">saveRawData</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">rawFilename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">rawDataFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">DataDirectory</span><span class="o">.</span><span class="n">DataDirectory</span><span class="p">()</span><span class="o">.</span><span class="n">sequencefile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">rawFilename</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">dataFinalized</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ScanExperiment.startScan"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.startScan">[docs]</a>    <span class="k">def</span> <span class="nf">startScan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">idle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">starting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">stopping</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">paused</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">interrupted</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppStop</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">awgName</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">AWGDevices</span><span class="o">.</span><span class="n">AWGDeviceDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="c1">#program any AWG (if necessary)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">(</span><span class="s1">&#39;hardware&#39;</span><span class="p">,</span> <span class="n">awgName</span><span class="p">):</span>
                    <span class="n">awgDevice</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scanTargetDict</span><span class="p">[</span><span class="n">awgName</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span>
                    <span class="k">if</span> <span class="n">awgDevice</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">deviceSettings</span><span class="p">[</span><span class="s1">&#39;programOnScanStart&#39;</span><span class="p">]:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Programming </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">awgName</span><span class="p">))</span>
                        <span class="n">awgDevice</span><span class="o">.</span><span class="n">program</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">PulseProgramBinary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">getPulseProgramBinary</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">GeneratorList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">scanMode</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataStore</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramIdentifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataStore</span><span class="o">.</span><span class="n">addData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">pppSource</span><span class="p">)</span>
            <span class="p">(</span><span class="n">mycode</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span><span class="o">.</span><span class="n">maxUpdatesToWrite</span> <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">writeRam</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">ramData</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">ramData</span> <span class="c1">#Overwrites anything set above by the gate sequence ui</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing </span><span class="si">{0}</span><span class="s2"> bytes to RAM (</span><span class="si">{1}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">24</span><span class="p">)</span> <span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppWriteRamWordList</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">datacopy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">datacopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppReadRamWordList</span><span class="p">(</span><span class="n">datacopy</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">!=</span><span class="n">datacopy</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;original: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">202</span> <span class="k">else</span> <span class="s2">&quot;original </span><span class="si">{0}</span><span class="s2"> ... </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span> <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;received: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datacopy</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datacopy</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">202</span> <span class="k">else</span> <span class="s2">&quot;received </span><span class="si">{0}</span><span class="s2"> ... </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datacopy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="n">datacopy</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span> <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ScanException</span><span class="p">(</span><span class="s2">&quot;Ram write unsuccessful datalength </span><span class="si">{0}</span><span class="s2"> checked length </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">datacopy</span><span class="p">)))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">gateSequenceSettings</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;debug.bin&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppFlushData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppClearWriteFifo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppUpload</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">PulseProgramBinary</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppWriteData</span><span class="p">(</span><span class="n">mycode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displayUi</span><span class="o">.</span><span class="n">onClear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestampsNewRun</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">unplotLastTrace</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">plottedTrace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">:</span>
                    <span class="n">plottedTrace</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#unplot previous trace</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">collapseLastTrace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span> <span class="c1">#reset plotted trace list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">otherDataFile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramBuffer</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span> <span class="nb">list</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span><span class="o">.</span><span class="n">startScan</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.onContinue"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onContinue">[docs]</a>    <span class="k">def</span> <span class="nf">onContinue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">is_interrupted</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received ion reappeared signal, will continue.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onPause</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="ScanExperiment.onPause"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onPause">[docs]</a>    <span class="k">def</span> <span class="nf">onPause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">paused</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">interrupted</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppFlushData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppClearWriteFifo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppWriteData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">restartCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;Starting&quot;</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppStart</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">resumeRunning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestampsNewRun</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;continued&quot;</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppStop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setPaused</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.onStash"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onStash">[docs]</a>    <span class="k">def</span> <span class="nf">onStash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pause the current run and stash all the variables.</span>
<span class="sd">        A stashed run can be interrupted by anythin and resumed&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setStashing</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span><span class="o">.</span><span class="n">onStash</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.stashSize"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.stashSize">[docs]</a>    <span class="k">def</span> <span class="nf">stashSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stash</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.onStashBottomHalf"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onStashBottomHalf">[docs]</a>    <span class="k">def</span> <span class="nf">onStashBottomHalf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">progressData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stash</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setIdle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stashChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stash</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">revertGlobals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globalVariables</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stashed </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">ScanExperimentContext</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.onResume"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onResume">[docs]</a>    <span class="k">def</span> <span class="nf">onResume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resume the stashed run given by index&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">is_idle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stash</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">overrideGlobals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globalVariables</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callWhenDoneAdjusting</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resumeMiddlePart</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callWhenDoneAdjusting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resumeMiddlePart</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.resumeMiddlePart"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.resumeMiddlePart">[docs]</a>    <span class="k">def</span> <span class="nf">resumeMiddlePart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.resumeBottomHalf"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.resumeBottomHalf">[docs]</a>    <span class="k">def</span> <span class="nf">resumeBottomHalf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppFlushData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppClearWriteFifo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppWriteData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">restartCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;Resuming&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppStart</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">progressData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">resumeRunning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestampsNewRun</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;continued&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stashChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stash</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.onInterrupt"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onInterrupt">[docs]</a>    <span class="k">def</span> <span class="nf">onInterrupt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppStop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setInterrupted</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span>       </div>

<div class="viewcode-block" id="ScanExperiment.onStop"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onStop">[docs]</a>    <span class="k">def</span> <span class="nf">onStop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;stopped&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">starting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">paused</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">interrupted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpStates</span><span class="o">.</span><span class="n">stopping</span> <span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">finalizeData</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="n">reason</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Analysis failed: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span><span class="o">.</span><span class="n">onStop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppStop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppClearWriteFifo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppFlushData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NeedsDDSRewrite</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.finalizeStop"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.finalizeStop">[docs]</a>    <span class="k">def</span> <span class="nf">finalizeStop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">revertGlobals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globalVariables</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppStopSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setIdle</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.traceFilename"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.traceFilename">[docs]</a>    <span class="k">def</span> <span class="nf">traceFilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">DataDirectory</span><span class="o">.</span><span class="n">DataDirectory</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">and</span> <span class="n">pattern</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">sequencefile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Save file&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">path</span></div>
            
<div class="viewcode-block" id="ScanExperiment.onData"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onData">[docs]</a>    <span class="k">def</span> <span class="nf">onData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">queuesize</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Called by worker with new data</span>
<span class="sd">        queuesize is the size of waiting messages, dont&#39;t do expensive unnecessary stuff if queue is deep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">is_running</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">is_stashing</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">other</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">gateSequenceSettings</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">otherDataFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dumpFilename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">DataDirectory</span><span class="o">.</span><span class="n">DataDirectory</span><span class="p">()</span><span class="o">.</span><span class="n">sequencefile</span><span class="p">(</span><span class="s2">&quot;other_data.bin&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">otherDataFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="n">dumpFilename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">otherDataFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">wordListToBytearray</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">other</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">overrun</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span> <span class="s2">&quot;Read Pipe Overrun&quot;</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onInterrupt</span><span class="p">(</span><span class="s2">&quot;Read Pipe Overrun&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">timingViolations</span><span class="p">:</span>
                <span class="n">oldlength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accumulatedTimingViolations</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accumulatedTimingViolations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">timingViolations</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accumulatedTimingViolations</span><span class="p">)</span><span class="o">&gt;</span><span class="n">oldlength</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">setTimingViolations</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">lineOfInstruction</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulatedTimingViolations</span><span class="p">])</span>
                    <span class="n">lineInPP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">lineOfInstruction</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">timingViolations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span> <span class="s2">&quot;PP Timing violation at address </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineInPP</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">final</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">exitcode</span> <span class="o">==</span> <span class="mh">0x100000000000</span><span class="p">:</span>  <span class="c1"># interrupt</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">queuesize</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">onStashBottomHalf</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">exitcode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">onInterrupt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">exitcode</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">exitcode</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">queuesize</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">queuesize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;pp not running ignoring onData </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">,</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span> <span class="n">data</span><span class="o">.</span><span class="n">scanvalue</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.processData"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.processData">[docs]</a>    <span class="k">def</span> <span class="nf">processData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">queuesize</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;onData </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">,</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span> <span class="n">data</span><span class="o">.</span><span class="n">scanvalue</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">xValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">rawDataFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">rawDataFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">data</span><span class="o">.</span><span class="n">dataString</span><span class="p">()</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">rawDataFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">rawDataFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span><span class="o">.</span><span class="n">onData</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">queuesize</span><span class="p">,</span> <span class="n">x</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.dataMiddlePart"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.dataMiddlePart">[docs]</a>    <span class="k">def</span> <span class="nf">dataMiddlePart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">queuesize</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_Q</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">m_as</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">xUnit</span><span class="p">)</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">evaluated</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">expected</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span> <span class="p">)</span>
        <span class="n">replacementDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">currentContext</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">valueView</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span> 
        <span class="k">for</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">algo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalAlgorithmList</span><span class="p">):</span>
            <span class="n">evaluated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">algo</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="n">expected</span><span class="p">,</span> <span class="n">ppDict</span><span class="o">=</span><span class="n">replacementDict</span><span class="p">,</span> <span class="n">globalDict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">globalVariables</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># returns mean, error, raw</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">evaluated</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displayUi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>  <span class="p">[</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">evaluated</span> <span class="p">]</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateMainGraph</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">evaluated</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">timeinterval</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">timeTickOffset</span><span class="p">,</span> <span class="n">queuesize</span>  <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showHistogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalAlgorithmList</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">other</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;Other: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">data</span><span class="o">.</span><span class="n">other</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentIndex</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">enableTimestamps</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestampsEnabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showTimestamps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scanMethod</span><span class="o">.</span><span class="n">prepareNextPoint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">ev</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">ev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">evaluated</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluatedDataSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="p">))))</span></div>
        
<div class="viewcode-block" id="ScanExperiment.updateMainGraph"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.updateMainGraph">[docs]</a>    <span class="k">def</span> <span class="nf">updateMainGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluated</span><span class="p">,</span> <span class="n">timeinterval</span><span class="p">,</span> <span class="n">timeTickOffset</span><span class="p">,</span> <span class="n">queuesize</span><span class="p">):</span> <span class="c1"># evaluated is list of mean, error, raw</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">:</span>
            <span class="n">traceCollection</span> <span class="o">=</span> <span class="n">TraceCollection</span><span class="p">(</span><span class="n">record_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">traceCollection</span><span class="o">.</span><span class="n">recordTimeinterval</span><span class="p">(</span><span class="n">timeTickOffset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">result</span><span class="p">),</span> <span class="n">evaluation</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">evaluated</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># result is None if there were no counter results</span>
                    <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="n">showerror</span> <span class="o">=</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="n">yColumnName</span> <span class="o">=</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">rawColumnName</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_raw&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">showerror</span><span class="p">:</span>
                        <span class="n">topColumnName</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_top&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">bottomColumnName</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_bottom&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">plottedTrace</span> <span class="o">=</span> <span class="n">PlottedTrace</span><span class="p">(</span><span class="n">traceCollection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">plotname</span><span class="p">][</span><span class="s2">&quot;view&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">plotname</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                                    <span class="n">pens</span><span class="o">.</span><span class="n">penList</span><span class="p">,</span> <span class="n">xColumn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">abszisse</span><span class="o">.</span><span class="n">columnName</span><span class="p">,</span>
                                                    <span class="n">yColumn</span><span class="o">=</span><span class="n">yColumnName</span><span class="p">,</span> <span class="n">topColumn</span><span class="o">=</span><span class="n">topColumnName</span><span class="p">,</span> <span class="n">bottomColumn</span><span class="o">=</span><span class="n">bottomColumnName</span><span class="p">,</span> 
                                                    <span class="n">rawColumn</span><span class="o">=</span><span class="n">rawColumnName</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">xAxisUnit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">xUnit</span><span class="p">,</span>
                                                    <span class="n">xAxisLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">scanParameter</span><span class="p">,</span> <span class="n">windowName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">plotname</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>                
                        <span class="n">plottedTrace</span> <span class="o">=</span> <span class="n">PlottedTrace</span><span class="p">(</span><span class="n">traceCollection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">plotname</span><span class="p">][</span><span class="s2">&quot;view&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">plotname</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                                    <span class="n">pens</span><span class="o">.</span><span class="n">penList</span><span class="p">,</span> <span class="n">xColumn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">abszisse</span><span class="o">.</span><span class="n">columnName</span><span class="p">,</span> <span class="n">yColumn</span><span class="o">=</span><span class="n">yColumnName</span><span class="p">,</span> <span class="n">rawColumn</span><span class="o">=</span><span class="n">rawColumnName</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                    <span class="n">xAxisUnit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">xUnit</span><span class="p">,</span> <span class="n">xAxisLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">scanParameter</span><span class="p">,</span> <span class="n">windowName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">plotname</span><span class="p">)</span>
                    <span class="n">xRange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">xRange</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_Q</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">xUnit</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">dimensionality</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">xRange</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="s2">&quot;Scan Data&quot;</span><span class="p">][</span><span class="s2">&quot;view&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span> <span class="o">*</span><span class="n">xRange</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="s2">&quot;Scan Data&quot;</span><span class="p">][</span><span class="s2">&quot;view&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">enableAutoRange</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">ViewBox</span><span class="o">.</span><span class="n">XAxis</span><span class="p">)</span>     
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">plottedTrace</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">settingsName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="s2">&quot;PulseProgram&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="s2">&quot;Scan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">autoSave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">autoSave</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">filenamePattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">filename</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">category</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">autoSave</span><span class="p">:</span>
                <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">getUniqueCategory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;UNSAVED_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">filenamePattern</span><span class="o">+</span><span class="s2">&quot;_</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unsavedTraceCount</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">plottedTrace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">:</span>
                <span class="n">plottedTrace</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">autoSave</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsavedTraceCount</span><span class="o">+=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">appendData</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluated</span><span class="p">,</span> <span class="n">timeinterval</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">plottedTrace</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">addTrace</span><span class="p">(</span><span class="n">plottedTrace</span><span class="p">,</span> <span class="n">pen</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">expandNew</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">appendData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluated</span><span class="p">,</span> <span class="n">timeinterval</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">queuesize</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">plottedTrace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">:</span>
                    <span class="n">plottedTrace</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.finalizeData"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.finalizeData">[docs]</a>    <span class="k">def</span> <span class="nf">finalizeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;end of scan&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">dataFinalized</span><span class="p">:</span>  <span class="c1"># is not yet finalized</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;finalize Data reason: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">saveData</span> <span class="o">=</span> <span class="n">reason</span> <span class="o">!=</span> <span class="s1">&#39;aborted&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">otherDataFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">otherDataFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">otherDataFile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">rawDataFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">rawDataFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">rawDataFile</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Closed raw data file&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="k">else</span><span class="p">[]):</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                    <span class="n">trace</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="s2">&quot;traceFinalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">autoSave</span><span class="p">:</span>
                        <span class="n">trace</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">saveData</span><span class="p">:</span>
                <span class="n">failedList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataAnalysis</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registerMeasurement</span><span class="p">(</span><span class="n">failedList</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">histogramSave</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onSaveHistogram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">histogramFilename</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">histogramFilename</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">dataFinalized</span> <span class="o">=</span> <span class="n">reason</span>
            <span class="n">allData</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allDataSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">allData</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ScanExperiment.dataAnalysis"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.dataAnalysis">[docs]</a>    <span class="k">def</span> <span class="nf">dataAnalysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">analysisName</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">currentAnalysisName</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">onLoadAnalysisConfiguration</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">analysisName</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="nb">dict</span><span class="p">(((</span><span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">plottedTrace</span><span class="p">)</span> <span class="k">for</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">plottedTrace</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">evalList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">))))</span></div>
                
            
<div class="viewcode-block" id="ScanExperiment.showTimestamps"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.showTimestamps">[docs]</a>    <span class="k">def</span> <span class="nf">showTimestamps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">roiWidth</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">binwidth</span><span class="p">)</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">timestep</span><span class="o">.</span><span class="n">m_as</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>
        <span class="n">myrange</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">roiStart</span><span class="o">.</span><span class="n">m_as</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">multiplier</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">roiStart</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">roiWidth</span><span class="p">)</span><span class="o">.</span><span class="n">m_as</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">multiplier</span><span class="p">)</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">timestamp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">timestampsChannel</span><span class="p">]),</span>
                               <span class="nb">range</span><span class="o">=</span><span class="n">myrange</span><span class="p">,</span>
                               <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">multiplier</span>
                                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">integrateTimestamps</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">integrationMode</span><span class="o">.</span><span class="n">IntegrateAll</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">integrateTimestamps</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">integrationMode</span><span class="o">.</span><span class="n">IntegrateRun</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestampsNewRun</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plottedTimestampTrace</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">rawdata</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">rawdata</span><span class="o">.</span><span class="n">addInt</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">timestamp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">timestampsChannel</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span> <span class="o">=</span> <span class="n">TraceCollection</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">saveRawData</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">rawdata</span> <span class="o">=</span> <span class="n">RawData</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">rawdata</span><span class="o">.</span><span class="n">addInt</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">timestamp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">timestampsChannel</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">settingsName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="o">.</span><span class="n">filenameCallback</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceFilename</span><span class="p">,</span> <span class="s2">&quot;Timestamp_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">filename</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plottedTimestampTrace</span> <span class="o">=</span> <span class="n">PlottedTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currentTimestampTrace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">][</span><span class="s2">&quot;view&quot;</span><span class="p">],</span> <span class="n">pens</span><span class="o">.</span><span class="n">penList</span><span class="p">,</span> <span class="n">windowName</span><span class="o">=</span><span class="s2">&quot;Timestamps&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestampTraceui</span><span class="o">.</span><span class="n">addTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plottedTimestampTrace</span><span class="p">,</span> <span class="n">pen</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>              
            <span class="c1"># pulseProgramHeader = stringutilit.commentarize( self.pulseProgramUi.documentationString() )</span>
            <span class="c1"># scanHeader = stringutilit.commentarize( repr(self.context.scan) )</span>
            <span class="c1"># self.plottedTimestampTrace.trace.header = &#39;\n&#39;.join((pulseProgramHeader, scanHeader))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestampsNewRun</span> <span class="o">=</span> <span class="kc">False</span>                       </div>
        
<div class="viewcode-block" id="ScanExperiment.showHistogram"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.showHistogram">[docs]</a>    <span class="k">def</span> <span class="nf">showHistogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">evalList</span><span class="p">,</span> <span class="n">evalAlgoList</span> <span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">algo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">evalList</span><span class="p">,</span> <span class="n">evalAlgoList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">showHistogram</span><span class="p">:</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">function</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">histogramBins</span> <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">integrateHistogram</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="p">)</span><span class="o">&gt;</span><span class="n">index</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="p">)</span><span class="o">&gt;</span><span class="n">index</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">function</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramBuffer</span><span class="p">[</span><span class="n">evaluation</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">numberTraces</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="p">[</span><span class="n">numberTraces</span><span class="p">:]</span>   <span class="c1"># remove elements that are not needed any more</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramTrace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramTrace</span> <span class="o">=</span> <span class="n">TraceCollection</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">histogram</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">fitFunction</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yColumnName</span> <span class="o">=</span> <span class="s1">&#39;y</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> 
                <span class="n">plottedHistogramTrace</span> <span class="o">=</span> <span class="n">PlottedTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramTrace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="s2">&quot;Histogram&quot;</span><span class="p">][</span><span class="s2">&quot;view&quot;</span><span class="p">],</span> <span class="n">pens</span><span class="o">.</span><span class="n">penList</span><span class="p">,</span> <span class="n">plotType</span><span class="o">=</span><span class="n">PlottedTrace</span><span class="o">.</span><span class="n">Types</span><span class="o">.</span><span class="n">steps</span><span class="p">,</span> <span class="c1">#@UndefinedVariable</span>
                                                     <span class="n">yColumn</span><span class="o">=</span><span class="n">yColumnName</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Histogram &quot;</span><span class="o">+</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">windowName</span><span class="o">=</span><span class="s2">&quot;Histogram&quot;</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramTrace</span><span class="o">.</span><span class="n">filenamePattern</span> <span class="o">=</span> <span class="s2">&quot;Hist_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">filename</span>
                <span class="n">plottedHistogramTrace</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">plottedHistogramTrace</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">plottedHistogramTrace</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">settingsName</span>
                <span class="n">plottedHistogramTrace</span><span class="o">.</span><span class="n">fitFunction</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plottedHistogramTrace</span><span class="p">)</span>
                <span class="n">plottedHistogramTrace</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberTraces</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">removePlots</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">[</span><span class="n">numberTraces</span><span class="p">:]</span></div>

<div class="viewcode-block" id="ScanExperiment.onCopyHistogram"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onCopyHistogram">[docs]</a>    <span class="k">def</span> <span class="nf">onCopyHistogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">plottedtrace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">addTrace</span><span class="p">(</span><span class="n">plottedtrace</span><span class="p">,</span> <span class="n">pen</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramTrace</span> <span class="o">=</span> <span class="n">TraceCollection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramCurveList</span> <span class="o">=</span> <span class="p">[]</span></div>
             
    
<div class="viewcode-block" id="ScanExperiment.onSaveHistogram"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onSaveHistogram">[docs]</a>    <span class="k">def</span> <span class="nf">onSaveHistogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filenameTemplate</span><span class="o">=</span><span class="s2">&quot;Histogram.txt&quot;</span><span class="p">):</span>
        <span class="n">tName</span><span class="p">,</span> <span class="n">tExtension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filenameTemplate</span><span class="p">)</span> <span class="k">if</span> <span class="n">filenameTemplate</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;Histogram&quot;</span><span class="p">,</span> <span class="s2">&quot;.txt&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">histogramlist</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">histogramBuffer</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">DataDirectory</span><span class="o">.</span><span class="n">DataDirectory</span><span class="p">()</span><span class="o">.</span><span class="n">sequencefile</span><span class="p">(</span><span class="n">tName</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="n">tExtension</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">histogram</span> <span class="ow">in</span> <span class="n">histogramlist</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">histogram</span><span class="p">)))</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ScanExperiment.onAddPlot"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onAddPlot">[docs]</a>    <span class="k">def</span> <span class="nf">onAddPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Plot Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Please enter a plot name: &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addPlot</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ScanExperiment.addPlot"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.addPlot">[docs]</a>    <span class="k">def</span> <span class="nf">addPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">dock</span> <span class="o">=</span> <span class="n">Dock</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">CoordinatePlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">_graphicsView</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">addDock</span><span class="p">(</span><span class="n">dock</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
        <span class="n">dock</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dock&quot;</span><span class="p">:</span><span class="n">dock</span><span class="p">,</span> <span class="s2">&quot;widget&quot;</span><span class="p">:</span><span class="n">widget</span><span class="p">,</span> <span class="s2">&quot;view&quot;</span><span class="p">:</span><span class="n">view</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">plotnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span> <span class="c1">#In case the program suddenly shuts down</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotsChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.onRemovePlot"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onRemovePlot">[docs]</a>    <span class="k">def</span> <span class="nf">onRemovePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requiredPlotNames</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Select Plot&quot;</span><span class="p">,</span> <span class="s2">&quot;Please select which plot to remove: &quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;dock&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">plotnames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">evaluation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">evalList</span><span class="p">:</span> <span class="c1">#Change any instance of the removed plot in the current scan evaluation to the default scan (&quot;Scan Data&quot;)</span>
                    <span class="k">if</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">plotname</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                        <span class="n">evaluation</span><span class="o">.</span><span class="n">plotname</span> <span class="o">=</span> <span class="s2">&quot;Scan Data&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span> <span class="c1">#In case the program suddenly shuts down</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;There are no plots which can be removed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotsChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

                
<div class="viewcode-block" id="ScanExperiment.onRenamePlot"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onRenamePlot">[docs]</a>    <span class="k">def</span> <span class="nf">onRenamePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requiredPlotNames</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Select Plot&quot;</span><span class="p">,</span> <span class="s2">&quot;Please select which plot to rename: &quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="n">newName</span><span class="p">,</span> <span class="n">newOk</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;New Plot Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Please enter a new plot name: &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newOk</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;dock&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">newName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">newName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">plotnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">plotnames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">evaluation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">evalList</span><span class="p">:</span> <span class="c1">#Update the current evaluation plot names, whether or not it has been saved</span>
                        <span class="k">if</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">plotname</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                            <span class="n">evaluation</span><span class="o">.</span><span class="n">plotname</span> <span class="o">=</span> <span class="n">newName</span>
                    <span class="k">for</span> <span class="n">settingsName</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">settingsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="c1">#Update all the saved evaluation plot names</span>
                        <span class="k">for</span> <span class="n">evaluation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">settingsDict</span><span class="p">[</span><span class="n">settingsName</span><span class="p">]</span><span class="o">.</span><span class="n">evalList</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">plotname</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                                <span class="n">evaluation</span><span class="o">.</span><span class="n">plotname</span> <span class="o">=</span> <span class="n">newName</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span> <span class="c1">#In case the program suddenly shuts down</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;There are no plots which can be renamed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotsChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>


<div class="viewcode-block" id="ScanExperiment.activate"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">MainWindowWidget</span><span class="o">.</span><span class="n">MainWindowWidget</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deviceSettings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">activated</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;Scan activated&quot;</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">ppFlushData</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">dataAvailable</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onData</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activated</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;activate&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">StatusMessage</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="ScanExperiment.deactivate"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">MainWindowWidget</span><span class="o">.</span><span class="n">MainWindowWidget</span><span class="o">.</span><span class="n">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activated</span> <span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s2">&quot;Scan deactivated&quot;</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulserHardware</span><span class="o">.</span><span class="n">dataAvailable</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onData</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">setIdle</span><span class="p">()</span></div>
                
<div class="viewcode-block" id="ScanExperiment.saveConfig"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.saveConfig">[docs]</a>    <span class="k">def</span> <span class="nf">saveConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s1">&#39;.MainWindow.State&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="o">.</span><span class="n">saveState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s1">&#39;.pyqtgraph-dockareastate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">saveState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s1">&#39;.plotNames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experimentName</span><span class="o">+</span><span class="s2">&quot;.axesType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;widget&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">timeAxis</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluationControlWidget</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceui</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedTraceui</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayUi</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitWidget</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ScanExperiment.onClose"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onClose">[docs]</a>    <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataStore</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataStore</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanExperiment.state"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.state">[docs]</a>    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">progressUi</span><span class="o">.</span><span class="n">state</span></div>
        
<div class="viewcode-block" id="ScanExperiment.onPrint"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.onPrint">[docs]</a>    <span class="k">def</span> <span class="nf">onPrint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">printer</span><span class="p">,</span> <span class="n">pdfPrinter</span><span class="p">,</span> <span class="n">preferences</span><span class="p">):</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotDict</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;widget&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">preferences</span><span class="o">.</span><span class="n">savePdf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">SceneToPrint</span><span class="p">(</span><span class="n">widget</span><span class="p">):</span>
                <span class="n">painter</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="p">(</span><span class="n">pdfPrinter</span><span class="p">)</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">render</span><span class="p">(</span> <span class="n">painter</span> <span class="p">)</span>
                <span class="k">del</span> <span class="n">painter</span>
        
        <span class="k">with</span> <span class="n">SceneToPrint</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">exporter</span> <span class="o">=</span> <span class="n">SVGExporter</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">_graphicsView</span><span class="o">.</span><span class="n">scene</span><span class="p">())</span>
            <span class="n">emfFilename</span> <span class="o">=</span> <span class="n">DataDirectory</span><span class="o">.</span><span class="n">DataDirectory</span><span class="p">()</span><span class="o">.</span><span class="n">sequencefile</span><span class="p">(</span><span class="n">target</span><span class="o">+</span><span class="s2">&quot;.svg&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">emfFilename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">preferences</span><span class="o">.</span><span class="n">exportEmf</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">preferences</span><span class="o">.</span><span class="n">inkscapeExecutable</span><span class="p">):</span>
                    <span class="n">InkscapeConversion</span><span class="o">.</span><span class="n">convertSvgEmf</span><span class="p">(</span><span class="n">preferences</span><span class="o">.</span><span class="n">inkscapeExecutable</span><span class="p">,</span> <span class="n">emfFilename</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Inkscape executable not found at &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preferences</span><span class="o">.</span><span class="n">inkscapeExecutable</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">preferences</span><span class="o">.</span><span class="n">exportPdf</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">preferences</span><span class="o">.</span><span class="n">inkscapeExecutable</span><span class="p">):</span>
                    <span class="n">InkscapeConversion</span><span class="o">.</span><span class="n">convertSvgPdf</span><span class="p">(</span><span class="n">preferences</span><span class="o">.</span><span class="n">inkscapeExecutable</span><span class="p">,</span> <span class="n">emfFilename</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Inkscape executable not found at &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preferences</span><span class="o">.</span><span class="n">inkscapeExecutable</span><span class="p">))</span>
        <span class="c1"># create an exporter instance, as an argument give it</span>
        <span class="c1"># the item you wish to export</span>
        <span class="k">with</span> <span class="n">SceneToPrint</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">preferences</span><span class="o">.</span><span class="n">gridLinewidth</span><span class="p">,</span> <span class="n">preferences</span><span class="o">.</span><span class="n">curveLinewidth</span><span class="p">):</span>
            <span class="n">exporter</span> <span class="o">=</span> <span class="n">ImageExporter</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">_graphicsView</span><span class="o">.</span><span class="n">scene</span><span class="p">())</span> 
      
            <span class="c1"># set export parameters if needed</span>
            <span class="n">pageWidth</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">pageRect</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
            <span class="n">pageHeight</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">pageRect</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
            <span class="n">exporter</span><span class="o">.</span><span class="n">parameters</span><span class="p">()[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pageWidth</span><span class="o">*</span><span class="n">preferences</span><span class="o">.</span><span class="n">printWidth</span>   <span class="c1"># (note this also affects height parameter)</span>
            <span class="n">exporter</span><span class="o">.</span><span class="n">widthChanged</span><span class="p">()</span>
              
            <span class="c1"># save to file</span>
            <span class="n">png</span> <span class="o">=</span> <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">toBytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">preferences</span><span class="o">.</span><span class="n">savePng</span><span class="p">:</span>
                <span class="n">png</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">DataDirectory</span><span class="o">.</span><span class="n">DataDirectory</span><span class="p">()</span><span class="o">.</span><span class="n">sequencefile</span><span class="p">(</span><span class="n">target</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">preferences</span><span class="o">.</span><span class="n">doPrint</span><span class="p">:</span>
                <span class="n">painter</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="p">(</span> <span class="n">printer</span> <span class="p">)</span>
                <span class="n">painter</span><span class="o">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPoint</span><span class="p">(</span><span class="n">pageWidth</span><span class="o">*</span><span class="n">preferences</span><span class="o">.</span><span class="n">printX</span><span class="p">,</span> <span class="n">pageHeight</span><span class="o">*</span><span class="n">preferences</span><span class="o">.</span><span class="n">printY</span><span class="p">),</span> <span class="n">png</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.updateScanTarget"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.updateScanTarget">[docs]</a>    <span class="k">def</span> <span class="nf">updateScanTarget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">parameterdict</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanTargetDict</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameterdict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanControlWidget</span><span class="o">.</span><span class="n">updateScanTarget</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameterdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ScanExperiment.registerMeasurement"><a class="viewcode-back" href="../../code/gui-doc.html#gui.ScanExperiment.ScanExperiment.registerMeasurement">[docs]</a>    <span class="k">def</span> <span class="nf">registerMeasurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">failedList</span><span class="p">):</span>
        <span class="n">failedEntry</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">name</span> <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">failedList</span><span class="p">))</span> <span class="k">if</span> <span class="n">failedList</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">measurement</span> <span class="o">=</span> <span class="n">Measurement</span><span class="p">(</span><span class="n">scanType</span><span class="o">=</span> <span class="s1">&#39;Scan&#39;</span><span class="p">,</span> <span class="n">scanName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">settingsName</span><span class="p">,</span> <span class="n">scanParameter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">scanParameter</span><span class="p">,</span> <span class="n">scanTarget</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">scanTarget</span><span class="p">,</span>
                                  <span class="n">scanPP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">loadPPName</span><span class="p">,</span>
                                  <span class="n">evaluation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">settingsName</span><span class="p">,</span>
                                  <span class="n">startDate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="s1">&#39;traceCreation&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="k">else</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
                                  <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">traceCollection</span><span class="o">.</span><span class="n">filename</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="k">else</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
                                  <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">longComment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">failedAnalysis</span><span class="o">=</span><span class="n">failedEntry</span><span class="p">)</span>
        <span class="c1"># add parameters</span>
        <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">getSpace</span><span class="p">(</span><span class="s1">&#39;PulseProgram&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramIdentifier</span><span class="p">:</span>
            <span class="n">measurement</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;identifier&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramIdentifier</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulseProgramUi</span><span class="o">.</span><span class="n">variableTableModel</span><span class="o">.</span><span class="n">variabledict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">measurement</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">outValue</span><span class="p">(),</span> <span class="n">definition</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">strvalue</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">))</span>
        <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">getSpace</span><span class="p">(</span><span class="s1">&#39;GlobalVariables&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globalVariables</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">measurement</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">targetname</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scanTargetDict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">getSpace</span><span class="p">(</span><span class="n">targetname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">measurement</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">strValue</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;strValue&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">)</span> <span class="p">)</span>
        <span class="c1"># add results</span>
        <span class="k">for</span> <span class="n">evaluationElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisControlWidget</span><span class="o">.</span><span class="n">analysisDefinition</span><span class="p">:</span>
            <span class="n">fit</span> <span class="o">=</span> <span class="n">evaluationElement</span><span class="o">.</span><span class="n">fitfunction</span><span class="o">.</span><span class="n">fitfunction</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">confidence</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">fit</span><span class="o">.</span><span class="n">parameterNames</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">parametersConfidence</span> <span class="p">):</span>
                <span class="n">fullName</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">evaluationElement</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">measurement</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Result</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fullName</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">confidence</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">fullName</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">evaluationElement</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">measurement</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Result</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fullName</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pushvar</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">evaluationElement</span><span class="o">.</span><span class="n">pushVariables</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">fullName</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">evaluationElement</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pushvar</span><span class="o">.</span><span class="n">variableName</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">measurement</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Result</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fullName</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">pushvar</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">pushvar</span><span class="o">.</span><span class="n">minimum</span> <span class="k">if</span> <span class="n">pushvar</span><span class="o">.</span><span class="n">minimum</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                                                                       <span class="n">top</span><span class="o">=</span><span class="n">pushvar</span><span class="o">.</span><span class="n">maximum</span> <span class="k">if</span> <span class="n">pushvar</span><span class="o">.</span><span class="n">maximum</span> <span class="k">else</span> <span class="kc">None</span><span class="p">))</span>   
        <span class="c1"># add Plots</span>
        <span class="n">measurement</span><span class="o">.</span><span class="n">plottedTraceList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">plottedTraceList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementLog</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">addMeasurement</span><span class="p">(</span> <span class="n">measurement</span> <span class="p">)</span></div></div>
            
                
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>